<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <!--    <script src="https://code.jquery.com/jquery-2.2.3.min.js"></script>-->
    <!--    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.6/js/materialize.min.js"></script>-->
    <!--    <script src="./js/script.js"></script>-->
        <link rel="stylesheet" href="https://cdn.datatables.net/1.10.22/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
<script src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Node Express Jquery Mysql crud</title>
</head>

<body>
    <div class="d-flex flex-column flex-md-row align-items-center p-3 px-md-4 mb-3 bg-white border-bottom shadow-sm">
        <h5 class="my-0 mr-md-auto font-weight-normal">Crud operation</h5>
        <nav class="my-2 my-md-0 mr-md-3">
            <a class="p-2 text-dark" href="#">Features</a>
            <a class="p-2 text-dark" href="#">Enterprise</a>
            <a class="p-2 text-dark" href="#">Support</a>
            <a class="p-2 text-dark" href="#">Pricing</a>
        </nav>
        <a class="btn btn-outline-primary" href="#">Sign up</a>
    </div>

    <div class="pricing-header px-3 py-3 pt-md-5 pb-md-4 mx-auto text-center">
        <h1 class="display-4">Add Data</h1>
        <p class="lead">Quickly build an effective pricing table for your potential customers with this Bootstrap example. Itâ€™s built with default Bootstrap components and utilities with little customization.</p>
    </div>

    <div class="container">
        <div class="card-deck mb-3">
            <div class="card mb-4 shadow-sm">
                <div class="card-header">
                    <h4 class="my-0 font-weight-normal">Add data here</h4>
                </div>
                <div class="card-body">
                    <form>
                        <div class="form-group">
                            <label for="formGroupExampleInput">Title</label>
                            <input type="text" class="form-control" id="input1" placeholder="Title">
                        </div>
                        <div class="form-group">
                            <label for="formGroupExampleInput2">Body</label>
                            <input type="text" class="form-control" id="input2" placeholder="Body">
                        </div>
                        <button id="save" type="button" class="btn btn-lg btn-outline-primary">Submit</button>
                    </form>

                </div>
            </div>
        </div>
    </div>
    
    <div class="container">
        <table class="table" id="tableDiv">
  <thead>
    <tr>
      <th scope="col">#</th>
      <th scope="col">First</th>
      <th scope="col">Last</th>
      <th scope="col">Handle</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th scope="row">1</th>
      <td>Mark</td>
      <td>Otto</td>
      <td>@mdo</td>
    </tr>
    <tr>
      <th scope="row">2</th>
      <td>Jacob</td>
      <td>Thornton</td>
      <td>@fat</td>
    </tr>
    <tr>
      <th scope="row">3</th>
      <td>Larry</td>
      <td>the Bird</td>
      <td>@twitter</td>
    </tr>
    <tr>
      <th scope="row">1</th>
      <td>Mark</td>
      <td>Otto</td>
      <td>@mdo</td>
    </tr>
    <tr>
      <th scope="row">2</th>
      <td>Jacob</td>
      <td>Thornton</td>
      <td>@fat</td>
    </tr>
    <tr>
      <th scope="row">3</th>
      <td>Larry</td>
      <td>the Bird</td>
      <td>@twitter</td>
    </tr>
    <tr>
      <th scope="row">1</th>
      <td>Mark</td>
      <td>Otto</td>
      <td>@mdo</td>
    </tr>
    <tr>
      <th scope="row">2</th>
      <td>Jacob</td>
      <td>Thornton</td>
      <td>@fat</td>
    </tr>
    <tr>
      <th scope="row">3</th>
      <td>Larry</td>
      <td>the Bird</td>
      <td>@twitter</td>
    </tr>

    
  </tbody>
</table>
    </div>

    <div class="modal fade" id="large-Modal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Edit Data</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="card-block">
                        <form id="editCaste">
                            <div class="form-group row">
                                <label class="col-sm-4 col-form-label">Post Title
                                    *</label>
                                <div class="col-sm-8">
                                    <input name="caste" class="form-control" type="text"
                                        placeholder="Enter Name Of Board" id="casteTitle" name="title" maxlength="30" required>
                                    <span class="messages popover-valid"></span>
                                    <input type="hidden" name="casteId" id="editCasteId" value="">
                                </div>
                            </div>
                            <div class="form-group row">
                                <label class="col-sm-4 col-form-label">Post Body
                                    *</label>
                                <div class="col-sm-8">
                                    <input name="caste" class="form-control" type="text"
                                        placeholder="Enter Name Of Board" id="casteBody" name="body" maxlength="30" required>
                                    <span class="messages popover-valid"></span>
                                </div>
                            </div>
                            <div class="row">
                                <label class="col-sm-2"></label>
                                <div class="col-sm-10">
                                    <div class="float-right">
                                      <!-- <button id="save" type="button" class="btn btn-lg btn-outline-primary">Submit</button> -->
                                        <button type="button" id="update" class="btn btn-primary m-b-0">Update</button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default waves-effect " data-dismiss="modal">Close</button>
                    <!-- <button type="button" class="btn btn-primary waves-effect waves-light ">Save changes</button> -->
                </div>
            </div>
        </div>
    </div>
</body>



<!--<script src="./js/script.js"></script>-->
    <script type="text/javascript">
        
        $(document).ready(function () {
            fetchCasteList();

            $("#save").click(function(){
            var title=$("#input1").val();
            var bodycontent=$("#input2").val();                
            
            var data1={
                title:title,            
                bodycontent:bodycontent
            };

            $.post('/insertdata', { title: title, bodycontent:bodycontent })
              .done(function( data ) {
                fetchCasteList();
              });

            // fetchCasteList();

// $.post( "test.php", { name: "John", time: "2pm" })
              // alert(data1);
              // console.log(Object.values(data1));
            // var data1 = [{"title":title,"bodycontent":"bodycontent"}]

/*                var xmlhttp = new XMLHttpRequest();
                var url = "http://localhost:3000/insertdata";


                xmlhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {

                var myArr = this.responseText;
                alert(myArr);
                fetchCasteList();
      }
    };
                xmlhttp.open("GET", url, true);
                xmlhttp.send(data1);*/

          });

            $("#update").click(function(){
            var id=$("#editCasteId").val();
            var title=$("#casteTitle").val();
            var bodycontent=$("#casteBody").val();                

            $.post('/editdata', { id: id, title: title, bodycontent:bodycontent });
            fetchCasteList();
              // alert(data1);
              // console.log(Object.values(data1));
            // var data1 = [{"title":title,"bodycontent":"bodycontent"}]

/*                var xmlhttp = new XMLHttpRequest();
                var url = "http://localhost:3000/insertdata";


                xmlhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {

                var myArr = this.responseText;
                alert(myArr);
                fetchCasteList();
      }
    };
                xmlhttp.open("GET", url, true);
                xmlhttp.send(data1);*/
        }); 
        });

/*        function deleteById(id) {
          alert(id);
            if (confirm("Are you sure you want to delete it?")) {
                $.ajax({
                    type: 'post',
                    url: "/deletepost/" + id,
                    data: {
                        id: id
                    },
                    dataType: 'json',
                    success: function (data6) {
                        alert(data6.msg);
                        fetchCasteList();
                    }
                });
            }
        }*/

        function deleteById(id) {
        var xmlhttp = new XMLHttpRequest();
        var url = "http://localhost:3000/deletepost/" + id;

        xmlhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
        // var myArr = JSON.parse(this.responseText);
        myArr = this.responseText;
        alert(myArr);
        fetchCasteList();
      }
    };
    xmlhttp.open("GET", url, true);
    xmlhttp.send();
        }


        function editById(ID) {
            var title;
            var id = ID;

                var xmlhttp = new XMLHttpRequest();
                var url = "http://localhost:3000/getpost/" + id;

                xmlhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                var myArr = JSON.parse(this.responseText);
                editFunction(myArr);
              }
            };
            xmlhttp.open("GET", url, true);
            xmlhttp.send();

            function editFunction(arr) {
                for(i = 0; i < arr.length; i++) {
                      $("#casteTitle").val(arr[i].title);
                      $("#casteBody").val(arr[i].body);
                      $("#editCasteId").val(arr[i].id);
                }  
            }
            $("#large-Modal").modal("show");

        }

        function fetchCasteList() {

var xmlhttp = new XMLHttpRequest();
var url = "http://localhost:3000/getposts";

xmlhttp.onreadystatechange = function() {
  if (this.readyState == 4 && this.status == 200) {
    var myArr = JSON.parse(this.responseText);
    myFunction(myArr);
  }
};
xmlhttp.open("GET", url, true);
xmlhttp.send();

function myFunction(arr) {
  var out = "";
  out += '<table  id="example" class="table table-striped table-bordered" style="width:100%"><thead><tr><th>ID</th><th>List Of Titles</th><th>Body</th> <th>Action</th></tr></thead><tbody id="record_list">';
  var i;
  for(i = 0; i < arr.length; i++) {
    out += '<tr><td>' + arr[i].id + '</td><td>' + arr[i].title + '</td><td>' + arr[i].body + '</td><td><div class="btn-group" role="group" aria-label="..."><button  class="btn btn-warning" onclick="editById(' + arr[i].id + ')" data-toggle="tooltip" title="Edit"><i class="fa fa-edit"></i></button><button  class="btn btn-danger" onclick="deleteById(' + arr[i].id + ')" data-toggle="tooltip" title="Delete"><i class="fa fa-trash"></i></button></div></td></tr>';
  };
out +='</tbody></table>';
  document.getElementById("tableDiv").innerHTML = out;
}
        }
    </script>
</html>